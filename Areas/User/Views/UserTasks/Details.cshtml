@model Balance.Models.UserTask
@using Balance.Models.Enums

@{
    ViewData["Title"] = "Task Details";
    var progressPercent = Model.HowManyTimes > 0
        ? (double)Model.CompletedCount / Model.HowManyTimes * 100
        : 0;
}

<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <div class="card card-clean shadow-sm border">

                <div class="card-header border-bottom-0 pt-4 pb-0 bg-transparent">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div>
                            <span class="badge theme-secondary me-2">
                                <i class="bi bi-repeat me-1"></i>@Model.Frequency
                            </span>
                            @if (Model.Frequency == Frequency.OneTime)
                            {
                                <span class="badge theme-danger">
                                    <i class="bi bi-calendar-event me-1"></i>@Model.Deadline.ToString("MMM dd")
                                </span>
                            }
                        </div>
                        <div>
                            <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-sm btn-primary rounded-pill px-3">
                                <i class="bi bi-pencil me-1"></i> Edit
                            </a>
                        </div>
                    </div>

                    <h2 class="fw-bold" style="color: var(--text-main);">@Model.Title</h2>

                    @if (Model.Tags != null && Model.Tags.Any())
                    {
                        <div class="mb-2 mt-3">
                            @foreach (var tag in Model.Tags)
                            {
                                <span class="badge rounded-pill me-1 fw-normal badge-tag"
                                      style="background-color: @tag.Color;">
                                    @tag.Name
                                </span>
                            }
                        </div>
                    }
                </div>

                <div class="card-body">
                    @if (!string.IsNullOrEmpty(Model.Description))
                    {
                        <p class="text-muted fs-6">@Model.Description</p>
                    }
                    else
                    {
                        <p class="text-muted fst-italic small">No description provided.</p>
                    }

                    <hr class="my-4" style="border-color: var(--border-color);" />

                    <div class="row text-center mb-4 g-2">
                        <div class="col-4">
                            <div class="p-3 rounded-3 h-100" style="background-color: var(--warning-soft);">
                                <div class="fs-4 fw-bold" style="color: var(--warning-text);">
                                    @Model.PointsPerClick <i class="bi bi-star-fill fs-6"></i>
                                </div>
                                <small class="text-muted text-uppercase" style="font-size: 0.7rem; letter-spacing: 0.5px;">Points</small>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="p-3 rounded-3 h-100" style="background-color: var(--primary-soft);">
                                <div class="fs-4 fw-bold" style="color: var(--primary-base);">@Model.CompletedCount</div>
                                <small class="text-muted text-uppercase" style="font-size: 0.7rem; letter-spacing: 0.5px;">Done</small>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="p-3 rounded-3 h-100" style="background-color: var(--bg-app);">
                                <div class="fs-4 fw-bold" style="color: var(--text-main);">@Model.HowManyTimes</div>
                                <small class="text-muted text-uppercase" style="font-size: 0.7rem; letter-spacing: 0.5px;">Target</small>
                            </div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <div class="d-flex justify-content-between small text-muted mb-1">
                            <span>Progress</span>
                            <span>@progressPercent.ToString("0")%</span>
                        </div>
                        <div class="progress" style="height: 10px; border-radius: 50rem; background-color: var(--border-color);">
                            <div class="progress-bar progress-bar-animated-custom @(Model.IsCompleted ? "bg-success" : "bg-primary")"
                                 role="progressbar"
                                 style="width: @progressPercent%">
                            </div>
                        </div>
                    </div>

                    <div class="d-flex justify-content-between small text-muted border rounded p-3" style="background-color: var(--bg-surface); border-color: var(--border-color);">
                        <div>
                            <i class="bi bi-clock-history me-1"></i> Last Active: <br>
                            <strong style="color: var(--text-main);">@Model.LastModified.ToString("g")</strong>
                        </div>
                        @if (Model.IsCompleted && Model.CompletedAt.HasValue)
                        {
                            <div class="text-end">
                                <i class="bi bi-check-circle-fill text-success me-1"></i> Finished: <br>
                                <strong style="color: var(--text-main);">@Model.CompletedAt.Value.ToString("g")</strong>
                            </div>
                        }
                    </div>
                </div>

                <div class="card-footer border-top-0 pb-4 pt-0 bg-transparent">
                    <a asp-action="Index" class="btn btn-light w-100 fw-bold border">
                        <i class="bi bi-arrow-left me-1"></i> Back to List
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>